### [业务流程模型](#)

-----

#### [业务1： 需求电力交易发布 - 甲方](#)
业务描述： `由于楼宇方无法承担上级要求调控的电量，所以使用磋商平台发布交易需求。楼宇方为甲方，需要乙方承担电荷调控，甲方给与乙方一定积分作为报酬。`

首先，甲方进入系统，发布交易需求，甲方需要提供如下信息: 

1. `默认值: 交易类型`
2. `选择所属指令： 指令ID`
3. `需要电荷值 默认单位 kw.h`
4. `默认给出积分值`: `自动生成 点击/积分 兑换比`
5. `交易结束时间`:`默认值为 指令结束前一个小时`
6. `发起方节点编号：后台通过 token 自动查找当前用户ID 前端提供token！` 
7. `交易编号 [自动生成] 长度最好 128位Hash + 自动增长 ID `
8. `发布时间 [后台接受到的请求时间]`
9. `积分是否可协商，如果积分可以协商则 兑换比为参考值！`

信息约束： 
1. [x] `指令必须是待执行指令。检查指令ID 是否合格`
2. [x] `电荷量不能无穷大， 不能超过上级下发电荷任务量`
3. [x] `积分量不能超过可用积分量。 比如可用积分 110. 需求填报的是 111 则非法` 

以上信息称为一个 `交易需求` ！ 具体的交易需要出价双方确认后具体生成
后台根据以上信息在数据库中添加一个需求信息，存储在需求信息表中。

存储完毕后，转到通知信息模块，有通知信息模块根据当前楼宇数量 - 1 = `number` 。 生成 `number` 个通知。所有的通知状态都是 未查看[enum]。

通知信息内容：
1. `自增ID`
2. `message： 有人发起了交易需求 ！`
3. `通知类型 3`
4. `生成时间 datetime`

发出交易需求业务然后处理完成。返回前端处理完成。 

```javascript
{
    isOK: true
}
```

如果以上处理过程中出现错误，那么请置 http状态码位 4xx。并给出错误信息 `message`

然后后台处理, 完成后， 前端收到成功处理消息后，刷新 `交易商场信息界面`。

#### [业务2： 需求电力交易出价 - 乙方](#)
业务描述： `由于乙方电力充足愿意帮助其他楼宇承担电荷调控，或者需要积分奖励，而尝试进行电力交易，承担电荷调控，并获得积分。`

乙方登录系统后，可以在页面侧边栏，发现通知信息为:`有人发布了新交易请求.` 点击后，前端会发起请求 `将某个通知设置为已查看`。如果乙方点击清除所有
通知，那么前端发起请求 `清除所有通知`。

如果后端获得请求 `将某个通知设置为已查看` 后端处理获得参数

1. `通知 ID`

处理完后，正常返回 `http状态码` 为 `200` 的报文就可以了

如果后端获得请求 `清除所有通知` 后端处理只需要根据 token。将当前用户对应的所有未查看通知信息，都设置为 已查看。

处理完后，正常返回 `http状态码`为 `200` 的报文就可以了

乙方可以在首页，浏览所有的交易请求，可以检索交易。检索交易需求的时候，可以向后端，发出检索需求请求。后端获得请求后，
根据分页要求展示数据。

乙方在交易磋商平台发现自己感兴趣的交易请求后，可以点击 `出价按钮`，进行出价, 弹出 `出价对话框` 需要填写如下的信息：
填写完毕后，点击提交按钮，后台获得请求数据如下：

1. `交易电荷量： 单位 kw.h`
2. `积分需要量： 如果不可协商则 根据兑换比自动生成`
3. `发起时间：[后台接受到的请求时间]`
4. `所属需求 ID`
5. `用户 token`

以上信息称为按照合同签署的一笔真实的待确认 `交易/合同`！

甲方可以点击上方热交易列表里面的 `查看电力交易` 查看自己发布的所有 `交易请求合同` 然后主页面切换为
`电力交易页面`



####  [业务3： 撤销电力交易需求 - 甲方](#)

业务描述： `甲方对于已经发布的交易需求设置条件不满意，或者反悔！ 撤销已经发布的电力交易需求。`



